<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yueqi(Charlene) Jin">
<meta name="dcterms.date" content="2023-10-15">

<title>Stawberries: exploratory data analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Strawsberry_files/libs/clipboard/clipboard.min.js"></script>
<script src="Strawsberry_files/libs/quarto-html/quarto.js"></script>
<script src="Strawsberry_files/libs/quarto-html/popper.min.js"></script>
<script src="Strawsberry_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Strawsberry_files/libs/quarto-html/anchor.min.js"></script>
<link href="Strawsberry_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Strawsberry_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Strawsberry_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Strawsberry_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Strawsberry_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stawberries: exploratory data analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yueqi(Charlene) Jin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><em>Final Objective of Data Research</em></p>
<p><em>1. Use Frequency of Top 15 Chemicals in various State</em></p>
<p><em>2. Visualize all chemicals and differentiate them by color based on their safety and toxicity</em></p>
<p><em>3. Toxic &amp; Safe Chemical Frequency by State</em></p>
<p><em>4. Toxic Chemical Use Frequency in Various States from 2016 to 2021</em></p>
<p><em>5. Safe Chemical Use Frequency in Various States from 2016 to 2021</em></p>
<p><em>6. Average Value of Strawberries using toxic chemicals &amp; safe chemicals</em></p>
<section id="data-acquisition-and-assessment" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition-and-assessment">Data acquisition and assessment</h2>
<!-- Read the file -->
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,314
Columns: 21
$ Program            &lt;chr&gt; "CENSUS", "CENSUS", "CENSUS", "CENSUS", "CENSUS", "…
$ Year               &lt;dbl&gt; 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 202…
$ Period             &lt;chr&gt; "YEAR", "YEAR", "YEAR", "YEAR", "YEAR", "YEAR", "YE…
$ `Week Ending`      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `Geo Level`        &lt;chr&gt; "STATE", "STATE", "STATE", "STATE", "STATE", "STATE…
$ State              &lt;chr&gt; "ALASKA", "ALASKA", "ALASKA", "ALASKA", "ALASKA", "…
$ `State ANSI`       &lt;chr&gt; "02", "02", "02", "02", "02", "02", "02", "06", "06…
$ `Ag District`      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `Ag District Code` &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ County             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `County ANSI`      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ `Zip Code`         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ Region             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ watershed_code     &lt;chr&gt; "00000000", "00000000", "00000000", "00000000", "00…
$ Watershed          &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ Commodity          &lt;chr&gt; "STRAWBERRIES", "STRAWBERRIES", "STRAWBERRIES", "ST…
$ `Data Item`        &lt;chr&gt; "STRAWBERRIES, ORGANIC - OPERATIONS WITH SALES", "S…
$ Domain             &lt;chr&gt; "ORGANIC STATUS", "ORGANIC STATUS", "ORGANIC STATUS…
$ `Domain Category`  &lt;chr&gt; "ORGANIC STATUS: (NOP USDA CERTIFIED)", "ORGANIC ST…
$ Value              &lt;chr&gt; "2", "(D)", "(D)", "(D)", "2", "(D)", "(D)", "142",…
$ `CV (%)`           &lt;chr&gt; "(H)", "(D)", "(D)", "(D)", "(H)", "(D)", "(D)", "1…</code></pre>
</div>
</div>
<p><em>We see that the top 10 states with the highest total value of strawberries each year.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Value column from non-numeric format to numeric</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>strawberry<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.]"</span>, <span class="st">""</span>, strawberry<span class="sc">$</span>Value))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data by Year and State, then compute the total value for each state per year</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>annual_state_value <span class="ot">&lt;-</span> strawberry <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Value =</span> <span class="fu">sum</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort data by Year and total value, then retrieve and format the top 10 states </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># by value for each year</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>top_states_each_year <span class="ot">&lt;-</span> annual_state_value <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Value)) <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Top_10_States =</span> <span class="fu">paste</span>(State, <span class="at">collapse=</span><span class="st">", "</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(top_states_each_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
   Year Top_10_States                                                           
  &lt;dbl&gt; &lt;chr&gt;                                                                   
1  2016 CALIFORNIA, FLORIDA, NORTH CAROLINA, OREGON, WASHINGTON, NEW YORK, VERM…
2  2017 CALIFORNIA, OTHER STATES, FLORIDA, NORTH CAROLINA, OREGON, WASHINGTON, …
3  2018 CALIFORNIA, FLORIDA, NORTH CAROLINA, OTHER STATES, OREGON, WASHINGTON, …
4  2019 CALIFORNIA, OTHER STATES, FLORIDA, OREGON, VERMONT, WASHINGTON, NEW YOR…
5  2020 OTHER STATES, CALIFORNIA, FLORIDA                                       
6  2021 OTHER STATES, CALIFORNIA, FLORIDA, OREGON, WASHINGTON, VERMONT, NEW YOR…
7  2022 OTHER STATES, CALIFORNIA, FLORIDA                                       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to keep only the top 10 states for each year</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>top_states_each_year_data <span class="ot">&lt;-</span> annual_state_value <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">10</span>, Total_Value) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the heatmap to visualize top 10 States with the Highest Total Value </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># of Strawberries Each Year</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_states_each_year_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(Year), <span class="at">y =</span> State, <span class="at">fill =</span> Total_Value)) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">name =</span> <span class="st">"Total Value"</span>) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 10 States with the Highest Total Value of Strawberries Each Year"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="data-cleaning-and-organization" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-organization">Data cleaning and organization</h2>
<!-- Remove columns with a single value in all columns -->
<!-- Glimpse of strawberry data after dropping single-value columns. -->
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,314
Columns: 10
$ Program           &lt;chr&gt; "CENSUS", "CENSUS", "CENSUS", "CENSUS", "CENSUS", "C…
$ Year              &lt;dbl&gt; 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021, 2021…
$ Period            &lt;chr&gt; "YEAR", "YEAR", "YEAR", "YEAR", "YEAR", "YEAR", "YEA…
$ State             &lt;chr&gt; "ALASKA", "ALASKA", "ALASKA", "ALASKA", "ALASKA", "A…
$ `State ANSI`      &lt;chr&gt; "02", "02", "02", "02", "02", "02", "02", "06", "06"…
$ `Data Item`       &lt;chr&gt; "STRAWBERRIES, ORGANIC - OPERATIONS WITH SALES", "ST…
$ Domain            &lt;chr&gt; "ORGANIC STATUS", "ORGANIC STATUS", "ORGANIC STATUS"…
$ `Domain Category` &lt;chr&gt; "ORGANIC STATUS: (NOP USDA CERTIFIED)", "ORGANIC STA…
$ Value             &lt;dbl&gt; 2, NA, NA, NA, 2, NA, NA, 142, 1413251, 311784980, 1…
$ `CV (%)`          &lt;chr&gt; "(H)", "(D)", "(D)", "(D)", "(H)", "(D)", "(D)", "19…</code></pre>
</div>
</div>
<!-- Examine California data -->
<!-- Separate CENSUS and SURVEY into two Data Frames -->
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(calif_census, calif_survey, state_all): object 'state_all' not
found</code></pre>
</div>
</div>
<!-- ## The Value column transformation -->
<section id="footnotes" class="level41">
<p class="heading">footnotes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## finds single uppor case Character in parens in s2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## e.g. "(D)"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## To fine the location and value of the footnotes</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> strwb_census<span class="sc">$</span>Value</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## find the footnote locations</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## fn_i: locations </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>fn_i <span class="ot">&lt;-</span> v <span class="sc">|&gt;</span> <span class="fu">str_detect</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">([:upper:]</span><span class="sc">\\</span><span class="st">)$"</span>) <span class="do">## returns</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="do">## dcomma returns numbers and NA's</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">dcomma</span>(v)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="do">## locations of NA's</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>na_i <span class="ot">&lt;-</span> <span class="fu">is.na</span>(v1)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>dcomma <span class="ot">&lt;-</span> <span class="cf">function</span>(c){</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  xnew <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">""</span>, c))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  fns <span class="ot">=</span> <span class="fu">unique</span>(c[<span class="fu">is.na</span>(xnew)])</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  vtran <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"new_vec"</span> <span class="ot">=</span> xnew, <span class="st">"footnotes"</span> <span class="ot">=</span> fns)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(vtran)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>v_trns <span class="ot">&lt;-</span> <span class="fu">dcomma</span>(v)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> v_trns<span class="sc">$</span>new_vec</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a> <span class="co"># a[1:20]</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a> <span class="co"># v_trns$footnotes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p><em>Chemicals: Firstly we divide the chemical composition into two columns and eliminating irrelevant variables.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> strwb_survey <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(<span class="st">`</span><span class="at">Data Item</span><span class="st">`</span>, <span class="st">"MEASURED IN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Data Item</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">str_extract</span>(<span class="st">`</span><span class="at">Data Item</span><span class="st">`</span>, <span class="st">"(?&lt;=MEASURED IN ).*"</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> stb_survey <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Chemical =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(<span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*=.*</span><span class="sc">\\</span><span class="st">)"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">str_extract</span>(<span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">=)"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">NA_character_</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Chemical_Code =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(<span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*=.*</span><span class="sc">\\</span><span class="st">)"</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_extract</span>(<span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">=).*?(?=</span><span class="sc">\\</span><span class="st">))"</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">NA_character_</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> <span class="fu">subset</span>(stb_survey, <span class="at">select =</span> <span class="sc">-</span>Program)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> <span class="fu">subset</span>(stb_survey, <span class="at">select =</span> <span class="sc">-</span><span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Chemical_Code_num <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(stb_survey<span class="sc">$</span>Chemical_Code)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Chemical_Code_str <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(stb_survey<span class="sc">$</span>Chemical_Code_num),<span class="cn">NA</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">sprintf</span>(<span class="st">"%06d"</span>, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                                               stb_survey<span class="sc">$</span>Chemical_Code_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Handing Missing Values, Outliers, and Duplicates</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> stb_survey[, <span class="sc">!</span><span class="fu">sapply</span>(stb_survey, <span class="cf">function</span>(col) <span class="fu">all</span>(<span class="fu">is.na</span>(col)))]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> stb_survey[<span class="sc">!</span><span class="fu">is.na</span>(stb_survey<span class="sc">$</span>Value), ]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>stb_survey <span class="ot">&lt;-</span> stb_survey[stb_survey<span class="sc">$</span>State <span class="sc">!=</span> <span class="st">"OTHER STATES"</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>strwb_census<span class="sc">$</span><span class="st">`</span><span class="at">CV (%)</span><span class="st">`</span><span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(strwb_census<span class="sc">$</span><span class="st">`</span><span class="at">CV (%)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>strwb_census <span class="ot">&lt;-</span> strwb_census <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Program,<span class="sc">-</span><span class="st">`</span><span class="at">Period</span><span class="st">`</span>,<span class="sc">-</span>Fruit,<span class="sc">-</span>crop_type,<span class="sc">-</span>Domain,<span class="sc">-</span><span class="st">`</span><span class="at">Domain Category</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Create a detailed visualization that illustrates the varying frequencies at which each individual chemical substance is utilized across the various states.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Domain <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"CHEMICAL,"</span>, <span class="st">""</span>, stb_survey<span class="sc">$</span>Domain)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Domain <span class="ot">&lt;-</span> <span class="fu">trimws</span>(stb_survey<span class="sc">$</span>Domain)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(stb_survey, <span class="at">file =</span> <span class="st">"stb_survey.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>top_chemicals_data <span class="ot">&lt;-</span> stb_survey <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Chemical) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract data for these top 15 chemicals from the original dataset.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>subset_stb_survey <span class="ot">&lt;-</span> stb_survey <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Chemical)) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> top_chemicals_data<span class="sc">$</span>Chemical)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(subset_stb_survey, <span class="fu">aes</span>(<span class="at">x =</span> Chemical, <span class="at">fill =</span> State)) <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"count"</span>) <span class="sc">+</span>  </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span>  </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Use Frequency of Top 15 Chemicals in various State"</span>, </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Use Frequency"</span>) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span>),  </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>The chart visualizes the use frequency of the top 15 chemicals across three states: California, Florida, and Washington. California, represented by the red color, seems to have the highest use frequency for most of the chemicals listed, as its bands are more pronounced and extend further outward on the chart. Florida, depicted in blue, also has significant use for many of these chemicals, but in general, its usage seems to be less than California for most of the chemicals. Washington, represented by the green color, has the least use frequency among the three states for almost all chemicals, as its bands are the narrowest. Specific chemicals like THIRAM, THIOPHANATE-METHYL, and SPINETORAM show notably high usage in California compared to the other two states. For some chemicals, such as AZOXYSTROBIN and ACETAMIPRID, the usage frequency appears to be relatively close between California and Florida, with both states showing notable use. ABAMECTIN has a discernible usage in Florida, even though it’s much less in comparison to California.</em></p>
<p><em>Then Create two subsets, poisons_chem and safe_chem, by filtering based on the values in the ‘Chemical’ column from the stb_survey data table.Visualize all chemicals and differentiate them by color based on their safety.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Data Cleaning: Remove blanks and standardize to lowercase, extract unique</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#chemical names and create a new dataframe to store these distinct chemical names</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Chemical <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">trimws</span>(stb_survey<span class="sc">$</span>Chemical))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>unique_chemicals <span class="ot">&lt;-</span> <span class="fu">unique</span>(stb_survey<span class="sc">$</span>Chemical)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>unique_chemicals_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Chemical =</span> unique_chemicals)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(unique_chemicals_df, <span class="at">file =</span> <span class="st">"unique_chemicals.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>poisonous_chemicals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"azoxystrobin"</span>, <span class="st">"blad"</span>, <span class="st">"boscalid"</span>, </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"bt subsp kurstaki evb-113-19"</span>, <span class="st">"captan"</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"copper octanoate"</span>, <span class="st">"cyflufenamid"</span>, <span class="st">"cyprodinil"</span>, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"difenoconazole"</span>, <span class="st">"fenhexamid"</span>, <span class="st">"fludioxonil"</span>, </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"fluopyram"</span>, <span class="st">"fluxapyroxad"</span>, <span class="st">"fosetyl-al"</span>, <span class="st">"isofetamid"</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"mefenoxam"</span>, <span class="st">"mono-potassium salt"</span>, <span class="st">"myclobutanil"</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"penthiopyrad"</span>, <span class="st">"polyoxin d zinc salt"</span>, <span class="st">"propiconazole"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"pyraclostrobin"</span>, <span class="st">"pyrimethanil"</span>, <span class="st">"quinoline"</span>, <span class="st">"sulfur"</span>, </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tetraconazole"</span>, <span class="st">"thiophanate-methyl"</span>, <span class="st">"thiram"</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"trifloxystrobin"</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"triflumizole"</span>, <span class="st">"carfentrazone-ethyl"</span>, <span class="st">"flumioxazin"</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"glyphosate iso. salt"</span>, <span class="st">"glyphosate pot. salt"</span>, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"napropamide"</span>, <span class="st">"oxyfluorfen"</span>, <span class="st">"paraquat"</span>, <span class="st">"pendimethalin"</span>, </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"abamectin"</span>, <span class="st">"acequinocyl"</span>, <span class="st">"acetamiprid"</span>, <span class="st">"azadirachtin"</span>, </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"bifenazate"</span>, <span class="st">"bifenthrin"</span>, <span class="st">"bt kurstak abts-1857"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"bt kurstaki abts-351"</span>, <span class="st">"bt kurstaki eg7841"</span>, </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"bt kurstaki sa-11"</span>, <span class="st">"bt sub aizawai gc-91"</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"buprofezin"</span>, <span class="st">"burkholderia a396 cells &amp; media"</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"chlorantraniliprole"</span>, </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"chromobac subtsugae praa4-1 cells and spent media"</span>, </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cyantraniliprole"</span>, <span class="st">"cyflumetofen"</span>, <span class="st">"diazinon"</span>, <span class="st">"etoxazole"</span>, </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"fenbutatin-oxide"</span>, <span class="st">"fenpropathrin"</span>, <span class="st">"fenpyroximate"</span>, </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"flonicamid"</span>, <span class="st">"flupyradifurone"</span>, <span class="st">"helicoverpa zea npv"</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"hexythiazox"</span>, <span class="st">"imidacloprid"</span>, <span class="st">"malathion"</span>, </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"methoxyfenozide"</span>, <span class="st">"naled"</span>, <span class="st">"novaluron"</span>, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"petroleum distillate"</span>, <span class="st">"piperonyl butoxide"</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"pyrethrins"</span>, <span class="st">"pyridaben"</span>, <span class="st">"pyriproxyfen"</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"spinetoram"</span>, <span class="st">"spinosad"</span>, <span class="st">"spiromesifen"</span>, </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"thiamethoxam"</span>, <span class="st">"acibenzolar-s-methyl"</span>, </span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"chloropicrin"</span>, <span class="st">"dichloropropene"</span>, <span class="st">"flutriafol"</span>, </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"metam-potassium"</span>, <span class="st">"peroxyacetic acid"</span>, <span class="st">"potassium silicate"</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"pydiflumetofen"</span>, <span class="st">"clethodim"</span>, <span class="st">"copper ethanolamine"</span>, </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"dimethenamid"</span>, <span class="st">"fluroxypyr 1-mhe"</span>, <span class="st">"halosulfuron-methyl"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"kantor"</span>, <span class="st">"carbaryl"</span>, <span class="st">"fenazaquin"</span>, <span class="st">"sulfoxaflor"</span>, </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cytokinins"</span>, <span class="st">"ethephon"</span>, <span class="st">"indolebutyric acid"</span>, </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"copper hydroxide"</span>, <span class="st">"glufosinate-ammonium"</span>, </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"sulfentrazone"</span>, <span class="st">"chlorpyrifos"</span>, <span class="st">"zeta-cypermethrin"</span>, </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"metaldehyde"</span>, <span class="st">"metam-sodium"</span>, <span class="st">"copper chloride hyd."</span>,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"dodine"</span>, <span class="st">"flutolanil"</span>, <span class="st">"2,4-d, dimeth. salt"</span>, <span class="st">"2,4-d, </span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="st">                         triiso. salt"</span>, </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cypermethrin"</span>, <span class="st">"alkyl. dim. benz. am"</span>, <span class="st">"decyldimethyloctyl"</span>,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"didecyl dim. ammon."</span>, <span class="st">"dimethyldioctyl"</span>, <span class="st">"iprodione"</span>, </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"cyflumetofen"</span>, <span class="st">"emamectin benzoate"</span>, <span class="st">"lambda-cyhalothrin"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"spirotetramat"</span>, <span class="st">"dimethyl disulfide (dmds)"</span>, </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"copper oxide"</span>, <span class="st">"ammonium pelargonate"</span>, <span class="st">"flubendiamide"</span>,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"methyl bromide"</span>, <span class="st">"chlorothalonil"</span>, <span class="st">"cyazofamid"</span>,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"mancozeb"</span>, <span class="st">"endosulfan"</span>, <span class="st">"clopyralid mono salt"</span>, </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"simazine"</span>, <span class="st">"terbacil"</span>, <span class="st">"ferric sodium edta"</span>, <span class="st">"clomazone"</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>safe_chemicals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bacillus amyloliquefaciens mbi 600"</span>, <span class="st">"bacillus amyloliquefac f727"</span>, </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"bacillus amyloliquefaciens strain d747"</span>, <span class="st">"bacillus pumilus"</span>, </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"bacillus subtilis"</span>, <span class="st">"beauveria bassiana"</span>, <span class="st">"borax decahydrate"</span>,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"canola oil"</span>, <span class="st">"streptomyces lydicus"</span>, <span class="st">"neem oil"</span>, </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"neem oil, clar. hyd."</span>, <span class="st">"hydrogen peroxide"</span>, <span class="st">"iron phosphate"</span>, </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"mineral oil"</span>, <span class="st">"potassium bicarbon."</span>, <span class="st">"potassium salts"</span>,</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"soybean oil"</span>, <span class="st">"aureobasidium pullulans dsm 14940"</span>, </span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"aureobasidium pullulans dsm 14941"</span>, <span class="st">"trichoderma harz."</span>,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"trichoderma virens strain g-41"</span>, <span class="st">"gliocladium virens"</span>, </span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"bacillus subt. gb03"</span>, <span class="st">"paecilomyces fumosor"</span>, </span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"reynoutria sachaline"</span>, <span class="st">"pseudomonas chlororaphis strain afs009"</span>,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"capsicum oleoresin extract"</span>, <span class="st">"garlic oil"</span>, <span class="st">"capric acid"</span>,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"caprylic acid"</span>, <span class="st">"mustard oil"</span>, <span class="st">"capsaicin"</span>, <span class="st">"harpin a b protein"</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>all_chemicals <span class="ot">&lt;-</span> <span class="fu">c</span>(safe_chemicals, poisonous_chemicals)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>unique_chemicals <span class="ot">&lt;-</span> <span class="fu">unique</span>(all_chemicals)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> unique_chemicals, </span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">ifelse</span>(unique_chemicals <span class="sc">%in%</span> safe_chemicals, <span class="st">"safe"</span>, <span class="st">"toxic"</span>)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">graph.empty</span>(<span class="at">n =</span> <span class="dv">0</span>, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">add_vertices</span>(graph, <span class="fu">nrow</span>(df), <span class="at">name =</span> df<span class="sc">$</span>name, <span class="at">type =</span> df<span class="sc">$</span>type)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(graph, <span class="at">layout =</span> <span class="st">'circle'</span>) <span class="sc">+</span> </span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">nudge_y =</span> <span class="fl">0.1</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">angle =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"safe"</span> <span class="ot">=</span> <span class="st">"darkmagenta"</span>, <span class="st">"toxic"</span> <span class="ot">=</span> <span class="st">"#D93600"</span>)) <span class="sc">+</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>stb_survey<span class="sc">$</span>Chemical <span class="ot">&lt;-</span> <span class="fu">trimws</span>(stb_survey<span class="sc">$</span>Chemical)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>poisons_chem <span class="ot">&lt;-</span> <span class="fu">subset</span>(stb_survey, Chemical <span class="sc">%in%</span> poisonous_chemicals)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>safe_chem <span class="ot">&lt;-</span> <span class="fu">subset</span>(stb_survey, Chemical <span class="sc">%in%</span> safe_chemicals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Deal with preprocessing data, calculate the count of toxic and non-toxic chemicals for each state.And Exclude states where both toxic and non-toxic chemical counts are zero.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stb_grouped <span class="ot">&lt;-</span> stb_survey <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">toxic_count =</span> <span class="fu">sum</span>(Chemical <span class="sc">%in%</span> poisonous_chemicals),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">safe_count =</span> <span class="fu">sum</span>(Chemical <span class="sc">%in%</span> safe_chemicals)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(toxic_count <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> safe_count <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width=</span><span class="dv">10</span>, <span class="at">repr.plot.height=</span><span class="dv">8</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stb_grouped, <span class="fu">aes</span>(<span class="at">y =</span> State)) <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> safe_count, <span class="at">xend =</span> toxic_count, <span class="at">yend =</span> State), <span class="at">color =</span> <span class="st">'grey'</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> safe_count, <span class="at">color =</span> <span class="st">"Safe"</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> toxic_count, <span class="at">color =</span> <span class="st">"Toxic"</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Toxic"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>, <span class="st">"Safe"</span> <span class="ot">=</span> <span class="st">"darkmagenta"</span>)) <span class="sc">+</span>  </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Count"</span>, <span class="at">y=</span><span class="st">"State"</span>, <span class="at">title=</span><span class="st">"Toxic &amp; Safe Chemical Frequency by State"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"States with zero count for both are excluded"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="st">"Chemical Type"</span>) <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>Among the three listed states, California has the highest frequency of both safe and toxic chemical usage.For safe chemicals, there is no safe chemical in Florida and Washington.When considering toxic chemicals, Florida’s frequency is noticeably higher than that of Washington.</em></p>
<p><em>Toxic Chemical Frequency in Various States from 2016 to 2021</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data to include only the specified domains</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>selected_domains <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"INSECTICIDE"</span>, <span class="st">"FUNGICIDE"</span>, <span class="st">"HERBICIDE"</span>, <span class="st">"OTHER"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>poisons_chem_selected <span class="ot">&lt;-</span> poisons_chem <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">%in%</span> selected_domains)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot with a custom color scale</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>toxic_plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> poisons_chem_selected, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Domain, <span class="at">col =</span> State)) <span class="sc">+</span>  </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year: 2016 - 2021'</span>) <span class="sc">+</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Chemical Type'</span>) <span class="sc">+</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Toxic Chemical Frequency in Various States from 2016 to 2021'</span>, </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Chemical type by year'</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkmagenta"</span>, <span class="st">"darkblue"</span>,<span class="st">"darkorange"</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>toxic_plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>From the plot regarding toxic chemicals, we can find that insecticide and fungicide widely used in strawberry farming in California and Florida. Strawberry farming in Washington only used insecticides, herbicides, and fungicides in 2016, but did not use them in subsequent years.</em></p>
<p><em>Safe Chemical Frequency in Various States from 2016 to 2021</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data to include only the specified domains</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>selected_domains <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"INSECTICIDE"</span>, <span class="st">"FUNGICIDE"</span>, <span class="st">"HERBICIDE"</span>, <span class="st">"OTHER"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>safe_chem_selected <span class="ot">&lt;-</span> safe_chem <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">%in%</span> selected_domains)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot with a custom color scale</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>toxic_plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> safe_chem_selected, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Domain, <span class="at">col =</span> State)) <span class="sc">+</span>  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'Year: 2016 - 2021'</span>) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'Chemical Type'</span>) <span class="sc">+</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Safe Chemical Frequency in Various States from 2016 to 2021'</span>, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Chemical type by year'</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkmagenta"</span>, <span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkorange"</span>))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>toxic_plot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>From the plot regarding safe chemicals, we can find that insecticide and fungicide widely only used in strawberry farming in California in all years.</em></p>
<p><em>We observe the distribution of the average value of strawberries in each state when using toxic chemicals.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>poisons_chem<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.]"</span>, <span class="st">""</span>, poisons_chem<span class="sc">$</span>Value))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure state names match. Convert both to lowercase to avoid discrepancies due to case.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>poisons_chem<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">tolower</span>(poisons_chem<span class="sc">$</span>State)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>us_states<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">tolower</span>(us_states<span class="sc">$</span>region)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average value for each state</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>state_avg_values <span class="ot">&lt;-</span> poisons_chem <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups=</span><span class="st">'drop'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the map data and the average values</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(us_states, state_avg_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">"State"</span>))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># If there are NA values in the merged data, you can replace them with zeros.</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>Avg_Value[<span class="fu">is.na</span>(map_data<span class="sc">$</span>Avg_Value)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Find the centroid of each state for placing the state label</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>state_centroids <span class="ot">&lt;-</span> map_data <span class="sc">%&gt;%</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cent_x =</span> <span class="fu">mean</span>(long, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">cent_y =</span> <span class="fu">mean</span>(lat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">Avg_Value =</span> <span class="fu">first</span>(Avg_Value))</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter centroids to keep only those states that have a non-zero Avg_Value</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>state_centroids <span class="ot">&lt;-</span> <span class="fu">filter</span>(state_centroids, Avg_Value <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a choropleth map with shades of blue and label states with non-zero average values</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">fill =</span> Avg_Value)) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> state_centroids, <span class="fu">aes</span>(<span class="at">x =</span> cent_x, <span class="at">y =</span> cent_y, <span class="at">label =</span> region),</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name =</span> <span class="st">"Average Value of Strawberries"</span>, <span class="at">low =</span> <span class="st">"lightblue"</span>, </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Value of Strawberries by State under the Use of Toxic Chemicals"</span>) <span class="sc">+</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>We observe the distribution of the average value of strawberries in each state when using safe chemicals.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>safe_chem<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.]"</span>, <span class="st">""</span>, safe_chem<span class="sc">$</span>Value))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure state names match. Convert both to lowercase to avoid discrepancies due to case.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>safe_chem<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">tolower</span>(safe_chem<span class="sc">$</span>State)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>us_states<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="fu">tolower</span>(us_states<span class="sc">$</span>region)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average value for each state</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>state_avg_values <span class="ot">&lt;-</span> safe_chem <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_Value =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups=</span><span class="st">'drop'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the map data and the average values</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>map_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(us_states, state_avg_values, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">"State"</span>))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># If there are NA values in the merged data, you can replace them with zeros.</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>map_data<span class="sc">$</span>Avg_Value[<span class="fu">is.na</span>(map_data<span class="sc">$</span>Avg_Value)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the centroid of each state for placing the state label</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>state_centroids <span class="ot">&lt;-</span> map_data <span class="sc">%&gt;%</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cent_x =</span> <span class="fu">mean</span>(long, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">cent_y =</span> <span class="fu">mean</span>(lat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">Avg_Value =</span> <span class="fu">first</span>(Avg_Value))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter centroids to keep only those states that have a non-zero Avg_Value</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>state_centroids <span class="ot">&lt;-</span> <span class="fu">filter</span>(state_centroids, Avg_Value <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a choropleth map with shades of blue and label states </span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># with non-zero average values</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> map_data, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">fill =</span> Avg_Value)) <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> state_centroids, <span class="fu">aes</span>(<span class="at">x =</span> cent_x, <span class="at">y =</span> cent_y, <span class="at">label =</span> region), </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name =</span> <span class="st">"Average Value of Strawberries"</span>, <span class="at">low =</span> <span class="st">"lightblue"</span>, </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Average Value of Strawberries by State under the Use of Safe Chemicals"</span>) <span class="sc">+</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Strawsberry_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>Based on the distribution from the two maps, we conclude that under both the use of toxic and non-toxic chemicals, the average value of strawberries in California is the highest. Furthermore, when using toxic chemicals, the average value of strawberries in Washington is the lowest.</em></p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p><em>https://www.osha.gov/chemicaldata</em></p>
<p><em>https://ordspub.epa.gov/ords/pesticides/f?p=113:17::::::</em></p>
<p><em>https://comptox.epa.gov/dashboard/</em></p>
<p><em>https://quickstats.nass.usda.gov/src/glossary.pdf</em></p>
<p><em>https://quickstats.nass.usda.gov/param_define</em></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>